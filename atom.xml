<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Siran Yang</title>
  <subtitle>æ¨æ–¯ç„¶çš„åšå®¢</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.sirany.me/"/>
  <updated>2016-04-17T12:49:08.000Z</updated>
  <id>http://blog.sirany.me/</id>
  
  <author>
    <name>Siran Yang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linuxä¸­çš„è¿›ç¨‹è°ƒåº¦ä¸è¿›ç¨‹åˆ‡æ¢</title>
    <link href="http://blog.sirany.me/2016/04/15/Linux%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E4%B8%8E%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2/"/>
    <id>http://blog.sirany.me/2016/04/15/Linuxä¸­çš„è¿›ç¨‹è°ƒåº¦ä¸è¿›ç¨‹åˆ‡æ¢/</id>
    <published>2016-04-15T10:22:13.000Z</published>
    <updated>2016-04-17T12:49:08.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;Linuxä¸­è¿›ç¨‹çš„è°ƒåº¦æ—¶æœº&quot;&gt;&lt;a href=&quot;#Linuxä¸­è¿›ç¨‹çš„è°ƒåº¦æ—¶æœº&quot; class=&quot;headerlink&quot; title=&quot;Linuxä¸­è¿›ç¨‹çš„è°ƒåº¦æ—¶æœº&quot;&gt;&lt;/a&gt;Linuxä¸­è¿›ç¨‹çš„è°ƒåº¦æ—¶æœº&lt;/h1&gt;&lt;p&gt;Linuxä¸­è¿›ç¨‹è¿›è¡Œè°ƒåº¦çš„æ—¶æœºæœ‰ä»¥ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸­æ–­å¤„ç†è¿‡ç¨‹ä¸­ç›´æ¥è°ƒç”¨&lt;code&gt;schedule()&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;ä¸­æ–­å¤„ç†å®Œåè¿”å›ç”¨æˆ·æ€ä¹‹å‰æ ¹æ®&lt;code&gt;need_resched&lt;/code&gt;æ ‡è®°å—²ç”¨&lt;code&gt;schedule()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å†…æ ¸çº¿ç¨‹ä¸»åŠ¨è°ƒç”¨&lt;code&gt;schedule()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚å¯¹äº&lt;em&gt;2&lt;/em&gt;å¯ä»¥åœ¨&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/arch/x86/kernel/entry_32.S#590&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;entry_32.S&lt;/a&gt;ä¸­æ‰¾åˆ°å¯¹åº”çš„ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	# perform work that needs to be done immediately before resumption&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;work_pending:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	testb $_TIF_NEED_RESCHED, %cl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	jz work_notifysig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;work_resched:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	call schedule&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	# ...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;å†…æ ¸å¯¹è¿›ç¨‹è°ƒåº¦çš„å¤„ç†&quot;&gt;&lt;a href=&quot;#å†…æ ¸å¯¹è¿›ç¨‹è°ƒåº¦çš„å¤„ç†&quot; class=&quot;headerlink&quot; title=&quot;å†…æ ¸å¯¹è¿›ç¨‹è°ƒåº¦çš„å¤„ç†&quot;&gt;&lt;/a&gt;å†…æ ¸å¯¹è¿›ç¨‹è°ƒåº¦çš„å¤„ç†&lt;/h1&gt;&lt;p&gt;å†…æ ¸ä¸­çš„&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/kernel/sched/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;sched&lt;/a&gt;ç›®å½•åŒ…å«äº†è¿›ç¨‹è°ƒåº¦ç›¸å…³çš„é€»è¾‘ï¼Œå…¶ä»–ä»£ç é€šè¿‡è°ƒç”¨&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/kernel/sched/core.c#2865&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;schedule()&lt;/code&gt;&lt;/a&gt;ä½¿å†…æ ¸è¿›è¡Œè¿›ç¨‹è°ƒåº¦ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;asmlinkage __visible &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; __&lt;span class=&quot;function&quot;&gt;sched &lt;span class=&quot;title&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct *tsk = current;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	sched_submit_work(tsk);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	__schedule();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;EXPORT_SYMBOL(schedule);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶ä¸­&lt;code&gt;__schedule()&lt;/code&gt;çš„ä»£ç ä¸­åŒ…æ‹¬äº†ä¸€äº›æ¯”è¾ƒå…³é”®çš„æ­¥éª¤ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;next = pick_next_task(rq, prev);&lt;/code&gt;ã€‚ä»run queueä¸­æŒ‘é€‰å‡ºä¸‹ä¸€ä¸ªè¿›ç¨‹å‡†å¤‡è°ƒå…¥ã€‚Linuxå†…æ ¸çš„è°ƒåº¦ç®—æ³•ä¸ºCFSï¼ˆCompletely Fair Schedulingï¼‰ï¼Œè¿›ç¨‹åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šç´¯ç§¯virtual runtimeï¼Œrun queueæ˜¯ä»¥virtual runtimeä»å°åˆ°å¤§ç»„ç»‡çš„çº¢é»‘æ ‘ã€‚è°ƒåº¦å™¨æ¯æ¬¡ä»run queueä¸­é€‰æ‹©virtual runtimeæœ€å°çš„è¿›ç¨‹ï¼ˆæœ€å·¦ä¾§çš„èŠ‚ç‚¹ï¼‰ä½œä¸ºè°ƒå…¥è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	context_switch(rq, prev, next); &lt;span class=&quot;comment&quot;&gt;/* unlocks the rq */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 	* The context switch have flipped the stack from under us&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * and restored the local variables which were saved when&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 	* this task called schedule() in the past. prev == current&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 	* is still correct, but it can be moved to another cpu/rq.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 	*/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * context_switch - switch to the new MM and the new&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * thread&#39;s register state.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;context_switch&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; rq *rq, &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct *prev,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct *next)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  	&lt;span class=&quot;comment&quot;&gt;/* Here we just switch the register state and the stack. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	switch_to(prev, next, prev);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  	&lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;switch_to(prev, next, last)&lt;/code&gt;è¿›è¡Œå†…æ ¸æ ˆä½ç½®ã€EFLAGSã€EIPçš„ä¿å­˜ä¸æ¢å¤ã€‚è¿™é‡ŒEIPçš„æ¢å¤æ˜¯å…ˆå°†&lt;code&gt;next_ip&lt;/code&gt;å‹åˆ°æ ˆä¸Šï¼Œä½¿ç”¨&lt;code&gt;jmp __switch_to&lt;/code&gt;è¿›è¡Œå‡½æ•°è°ƒè½¬ï¼Œå½“ä»&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/arch/arc/kernel/ctx_sw.c#23&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;__switch_to&lt;/code&gt;&lt;/a&gt;ä¸­è¿”å›æ—¶å°±ä¼šè¿”å›åˆ°æ–°çš„è¿›ç¨‹çš„æ‰§è¡Œä½ç½®ä¸Šï¼ˆ&lt;code&gt;1:&lt;/code&gt;æˆ–è€…&lt;code&gt;ret_from_fork:&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Saving eflags is important. It switches not only IOPL between tasks,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * it also protects other tasks from NT leaking through sysenter etc.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; switch_to(prev, next, last)					\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;do &amp;#123;									\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/*								\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * Context-switching clobbers all registers, so we clobber	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * them explicitly, via unused output variables.		\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * (EAX and EBP is not listed because EBP is saved/restored	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * explicitly for wchan access and EAX is the return value of	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * __switch_to())						\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 */&lt;/span&gt;								\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	unsigned long ebx, ecx, edx, esi, edi;				\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;									\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	asm volatile(&lt;span class=&quot;string&quot;&gt;&quot;pushfl\n\t&quot;&lt;/span&gt;		&lt;span class=&quot;comment&quot;&gt;/* save    flags */&lt;/span&gt;	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;string&quot;&gt;&quot;pushl %%ebp\n\t&quot;&lt;/span&gt;		&lt;span class=&quot;comment&quot;&gt;/* save    EBP   */&lt;/span&gt;	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;string&quot;&gt;&quot;movl %%esp,%[prev_sp]\n\t&quot;&lt;/span&gt;	&lt;span class=&quot;comment&quot;&gt;/* save    ESP   */&lt;/span&gt; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;string&quot;&gt;&quot;movl %[next_sp],%%esp\n\t&quot;&lt;/span&gt;	&lt;span class=&quot;comment&quot;&gt;/* restore ESP   */&lt;/span&gt; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;string&quot;&gt;&quot;movl $1f,%[prev_ip]\n\t&quot;&lt;/span&gt;	&lt;span class=&quot;comment&quot;&gt;/* save    EIP   */&lt;/span&gt;	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;string&quot;&gt;&quot;pushl %[next_ip]\n\t&quot;&lt;/span&gt;	&lt;span class=&quot;comment&quot;&gt;/* restore EIP   */&lt;/span&gt;	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     __switch_canary					\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;string&quot;&gt;&quot;jmp __switch_to\n&quot;&lt;/span&gt;	&lt;span class=&quot;comment&quot;&gt;/* regparm call  */&lt;/span&gt;	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;string&quot;&gt;&quot;1:\t&quot;&lt;/span&gt;						\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;string&quot;&gt;&quot;popl %%ebp\n\t&quot;&lt;/span&gt;		&lt;span class=&quot;comment&quot;&gt;/* restore EBP   */&lt;/span&gt;	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;string&quot;&gt;&quot;popfl\n&quot;&lt;/span&gt;			&lt;span class=&quot;comment&quot;&gt;/* restore flags */&lt;/span&gt;	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;									\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     &lt;span class=&quot;comment&quot;&gt;/* output parameters */&lt;/span&gt;				\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     : [prev_sp] &lt;span class=&quot;string&quot;&gt;&quot;=m&quot;&lt;/span&gt; (prev-&amp;gt;thread.sp),		\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       [prev_ip] &lt;span class=&quot;string&quot;&gt;&quot;=m&quot;&lt;/span&gt; (prev-&amp;gt;thread.ip),		\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       &lt;span class=&quot;string&quot;&gt;&quot;=a&quot;&lt;/span&gt; (last),					\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;									\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       &lt;span class=&quot;comment&quot;&gt;/* clobbered output registers: */&lt;/span&gt;		\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       &lt;span class=&quot;string&quot;&gt;&quot;=b&quot;&lt;/span&gt; (ebx), &lt;span class=&quot;string&quot;&gt;&quot;=c&quot;&lt;/span&gt; (ecx), &lt;span class=&quot;string&quot;&gt;&quot;=d&quot;&lt;/span&gt; (edx),		\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       &lt;span class=&quot;string&quot;&gt;&quot;=S&quot;&lt;/span&gt; (esi), &lt;span class=&quot;string&quot;&gt;&quot;=D&quot;&lt;/span&gt; (edi)				\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       							\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       __switch_canary_oparam				\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;									\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       &lt;span class=&quot;comment&quot;&gt;/* input parameters: */&lt;/span&gt;				\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     : [next_sp]  &lt;span class=&quot;string&quot;&gt;&quot;m&quot;&lt;/span&gt; (next-&amp;gt;thread.sp),		\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       [next_ip]  &lt;span class=&quot;string&quot;&gt;&quot;m&quot;&lt;/span&gt; (next-&amp;gt;thread.ip),		\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       							\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       &lt;span class=&quot;comment&quot;&gt;/* regparm parameters for __switch_to(): */&lt;/span&gt;	\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       [prev]     &lt;span class=&quot;string&quot;&gt;&quot;a&quot;&lt;/span&gt; (prev),				\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       [next]     &lt;span class=&quot;string&quot;&gt;&quot;d&quot;&lt;/span&gt; (next)				\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;									\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       __switch_canary_iparam				\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;									\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     : &lt;span class=&quot;comment&quot;&gt;/* reloaded segment registers */&lt;/span&gt;			\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;string&quot;&gt;&quot;memory&quot;&lt;/span&gt;);					\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; while (0)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;ä½¿ç”¨gdbè·Ÿè¸ªschedule-å‡½æ•°&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨gdbè·Ÿè¸ªschedule-å‡½æ•°&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨gdbè·Ÿè¸ªschedule()å‡½æ•°&quot;&gt;&lt;/a&gt;ä½¿ç”¨gdbè·Ÿè¸ªschedule()å‡½æ•°&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨gdbåœ¨ä¸Šé¢æåˆ°è¿‡çš„å‡ ä¸ªå‡½æ•°å…¥å£è®¾ç½®æ–­ç‚¹ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/15/Linuxä¸­çš„è¿›ç¨‹è°ƒåº¦ä¸è¿›ç¨‹åˆ‡æ¢/breaks.png&quot; alt=&quot;è®¾ç½®æ–­ç‚¹&quot; title=&quot;è®¾ç½®æ–­ç‚¹&quot;&gt;
&lt;p&gt;ç»§ç»­æ‰§è¡Œï¼Œå†…æ ¸åœ¨è°ƒåº¦æ—¶è¿›å…¥&lt;code&gt;schedule()&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/15/Linuxä¸­çš„è¿›ç¨‹è°ƒåº¦ä¸è¿›ç¨‹åˆ‡æ¢/schedule.png&quot; alt=&quot;schedule()&quot; title=&quot;schedule()&quot;&gt;
&lt;p&gt;&lt;code&gt;schedule()&lt;/code&gt;ä¸­è°ƒç”¨äº†&lt;code&gt;pick_next_task(rq, prev)&lt;/code&gt;å’Œ&lt;code&gt;context_switch(rq, prev, next)&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/15/Linuxä¸­çš„è¿›ç¨‹è°ƒåº¦ä¸è¿›ç¨‹åˆ‡æ¢/pick_next_task_and_context_switch.png&quot; alt=&quot;pick_next_task å’Œ context_switch&quot; title=&quot;pick_next_task å’Œ context_switch&quot;&gt;
&lt;p&gt;æ‰§è¡Œ&lt;code&gt;switch_to(prev, next, last)&lt;/code&gt;ï¼Œè°ƒè½¬åˆ°&lt;code&gt;__switch_to&lt;/code&gt;å‡½æ•°ï¼Œè¿”å›åˆ°ä¹‹å‰å‹åˆ°æ ˆä¸Šçš„è¢«è°ƒå…¥è¿›ç¨‹çš„EIPâ€”â€”&lt;code&gt;ret_from_fork&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/15/Linuxä¸­çš„è¿›ç¨‹è°ƒåº¦ä¸è¿›ç¨‹åˆ‡æ¢/ret_from_fork.png&quot; alt=&quot;ret_from_fork&quot; title=&quot;ret_from_fork&quot;&gt;
&lt;h1 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h1&gt;&lt;p&gt;å¦‚æœè¯´å†…æ ¸æ˜¯ä¸€ç»„ä¸­æ–­æœåŠ¡ä¾‹ç¨‹çš„é›†åˆï¼Œé‚£ä¹ˆè¿™äº›æœåŠ¡ä¾‹ç¨‹æ‰€è”ç»“çš„å°±æ˜¯ç³»ç»Ÿä¸­è¿è¡Œçš„ä¸€ä¸ªä¸ªè¿›ç¨‹ã€‚å¤šä¸ªç”¨æˆ·è¿›ç¨‹åŒæ—¶è¿è¡Œåœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œä»–ä»¬æ— æ³•ä¸»åŠ¨çš„è¿›ç¨‹è°ƒåº¦ã€‚å½“ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œå†…æ ¸å¼€å§‹æ‰§è¡Œï¼Œå“åº”è¯¥ä¸­æ–­ã€‚è€Œæ‰§è¡Œå®Œæˆåç³»ç»Ÿå¯èƒ½è¿”å›åˆ°æ–°çš„è¿›ç¨‹ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‚è€ƒèµ„æ–™&quot;&gt;&lt;a href=&quot;#å‚è€ƒèµ„æ–™&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒèµ„æ–™&quot;&gt;&lt;/a&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.kernel.org/doc/Documentation/scheduler/sched-design-CFS.txt&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CFS Scheduler&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;www.ece.ubc.ca/~sasha/papers/eurosys16-final29.pdf&quot;&gt;Lozi, Jean-Pierre, et al. â€œThe Linux Scheduler: a Decade of Wasted Cores.â€ EuroSys 2016. 2016.&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 i
    
    </summary>
    
    
      <category term="Linux" scheme="http://blog.sirany.me/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linuxä¸­è£…è½½å’Œå¯åŠ¨å¯æ‰§è¡Œç¨‹åº</title>
    <link href="http://blog.sirany.me/2016/04/10/Linux%E4%B8%AD%E8%A3%85%E8%BD%BD%E5%92%8C%E5%90%AF%E5%8A%A8%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F/"/>
    <id>http://blog.sirany.me/2016/04/10/Linuxä¸­è£…è½½å’Œå¯åŠ¨å¯æ‰§è¡Œç¨‹åº/</id>
    <published>2016-04-10T09:42:14.000Z</published>
    <updated>2016-04-11T04:31:18.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„  &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;ELFå¯æ‰§è¡Œæ ¼å¼&quot;&gt;&lt;a href=&quot;#ELFå¯æ‰§è¡Œæ ¼å¼&quot; class=&quot;headerlink&quot; title=&quot;ELFå¯æ‰§è¡Œæ ¼å¼&quot;&gt;&lt;/a&gt;ELFå¯æ‰§è¡Œæ ¼å¼&lt;/h1&gt;&lt;p&gt;Linuxä¸­å¯æ‰§è¡Œæ–‡ä»¶ä»¥&lt;a href=&quot;https://en.wikipedia.org/wiki/Executable_and_Linkable_Format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ELFæ ¼å¼&lt;/a&gt;ç»„ç»‡ã€‚åŒ…æ‹¬å¯æ‰§è¡Œç¨‹åºï¼ˆexecutableï¼‰ï¼Œç›®æ ‡æ–‡ä»¶ï¼ˆobjectï¼‰å’Œå…±äº«åº“ï¼ˆshared libraryï¼‰ã€‚ELFæ–‡ä»¶ä¸­åŒ…æ‹¬ELF headerã€Program header tableï¼ˆå°†æ–‡ä»¶ç»„ç»‡ä¸ºè‹¥å¹²segmentï¼‰ã€Section header tableï¼ˆå°†æ–‡ä»¶ç»„ç»‡ä¸ºè‹¥å¹²sectionï¼‰ï¼Œä»¥åŠè‹¥å¹²éƒ¨åˆ†çš„æ•°æ®ã€‚å†…æ ¸è´Ÿè´£è¯»å–ELFæ–‡ä»¶ï¼Œå¹¶å°†æ•°æ®åŠ è½½åˆ°è¿›ç¨‹å†…å­˜ç©ºé—´å¯¹åº”çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;h1 id=&quot;Linuxä¸­çš„è£…è½½ä¸é“¾æ¥&quot;&gt;&lt;a href=&quot;#Linuxä¸­çš„è£…è½½ä¸é“¾æ¥&quot; class=&quot;headerlink&quot; title=&quot;Linuxä¸­çš„è£…è½½ä¸é“¾æ¥&quot;&gt;&lt;/a&gt;Linuxä¸­çš„è£…è½½ä¸é“¾æ¥&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://gist.github.com/yangsiran/731d976a3aa8842d667aa0b6dbdd8833&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://gist.github.com/yangsiran/731d976a3aa8842d667aa0b6dbdd8833&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Linuxä¸­ä½¿ç”¨exec*ç³»åˆ—çš„ç³»ç»Ÿè°ƒç”¨æ¥åŠ è½½ç¨‹åºï¼Œè¢«åŠ è½½çš„ç¨‹åºè¦†ç›–åŸæœ‰è¿›ç¨‹çš„ç©ºé—´ï¼Œå¹¶ä»ç¨‹åºå…¥å£å‡ºå¼€å§‹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç å¯ä»¥ä»¥åº“çš„å½¢å¼ç»„ç»‡ï¼Œå…¶ä¸­åŠ¨æ€é“¾æ¥åº“å¯ä»¥è¢«å¤šä¸ªå¯æ‰§è¡Œç¨‹åºå…±äº«ã€‚Linuxä¸­ä½¿ç”¨&lt;code&gt;ldd&lt;/code&gt;å¯ä»¥æŸ¥çœ‹ç¨‹åºæ‰€é“¾æ¥çš„åŠ¨æ€åº“ã€‚åŠ¨æ€åº“ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code&gt;dlopen&lt;/code&gt;æ¥åœ¨è¿è¡Œæ—¶åŠ è½½ï¼Œä½¿ç”¨&lt;code&gt;dlsym&lt;/code&gt;å¯ä»¥ä»åŠ¨æ€åº“ä¸­æ‰¾åˆ°ç›¸åº”çš„ç¬¦å·ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å†…æ ¸å¯¹execveç³»ç»Ÿè°ƒç”¨çš„å¤„ç†&quot;&gt;&lt;a href=&quot;#å†…æ ¸å¯¹execveç³»ç»Ÿè°ƒç”¨çš„å¤„ç†&quot; class=&quot;headerlink&quot; title=&quot;å†…æ ¸å¯¹execveç³»ç»Ÿè°ƒç”¨çš„å¤„ç†&quot;&gt;&lt;/a&gt;å†…æ ¸å¯¹execveç³»ç»Ÿè°ƒç”¨çš„å¤„ç†&lt;/h1&gt;&lt;p&gt;åœ¨&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/fs/exec.c#1604&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;exec.c&lt;/a&gt;ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®šä¹‰ç³»ç»Ÿè°ƒç”¨&lt;code&gt;execve&lt;/code&gt;çš„ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SYSCALL_DEFINE3(execve,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; __user *, filename,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; __user *&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; __user *, argv,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; __user *&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; __user *, envp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; do_execve(getname(filename), argv, envp);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;do_execve&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; filename *filename,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; __user *&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; __user *__argv,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; __user *&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; __user *__envp)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; user_arg_ptr argv = &amp;#123; .ptr.native = __argv &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; user_arg_ptr envp = &amp;#123; .ptr.native = __envp &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; do_execve_common(filename, argv, envp);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;do_execve_common&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; filename *filename,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; user_arg_ptr argv,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; user_arg_ptr envp)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; linux_binprm *bprm;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; file *file = do_open_exec(filename);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	copy_strings(bprm-&amp;gt;envc, envp, bprm);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	copy_strings(bprm-&amp;gt;argc, argv, bprm);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	exec_binprm(bprm);	&lt;span class=&quot;comment&quot;&gt;/* search_binary_handler(bprm); */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;search_binary_handler&lt;/code&gt;æŸ¥æ‰¾åˆé€‚çš„handleræ¥åŠ è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/fs/exec.c#1352&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;exec.c&lt;/a&gt;ä¸­å¯ä»¥çœ‹åˆ°ä¸€æ®µéå†æ ¼å¼çš„ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;search_binary_handler&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; linux_binprm *bprm)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; linux_binfmt *fmt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	list_for_each_entry(fmt, &amp;amp;formats, lh) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!try_module_get(fmt-&amp;gt;module))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		fmt-&amp;gt;load_binary(bprm);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œ&lt;code&gt;&amp;amp;formats&lt;/code&gt;æ˜¯åŒ…å«æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼çš„é“¾è¡¨ï¼Œåœ¨&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/fs/binfmt_elf.c#82&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;binfmt_elf.c&lt;/a&gt;ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³äºELFæ ¼å¼çš„èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; linux_binfmt elf_format = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	.module		= THIS_MODULE,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	.load_binary	= load_elf_binary,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	.load_shlib	= load_elf_library,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	.core_dump	= elf_core_dump,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	.min_coredump	= ELF_EXEC_PAGESIZE,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; __&lt;span class=&quot;function&quot;&gt;init &lt;span class=&quot;title&quot;&gt;init_elf_binfmt&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	register_binfmt(&amp;amp;elf_format);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶ä¸­&lt;code&gt;load_elf_binary&lt;/code&gt;ä¸ºå¤„ç†ELFæ ¼å¼åŠ è½½é€»è¾‘çš„å‡½æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;load_elf_binary&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; linux_binprm *bprm)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; * elf_interpreterï¼›&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (elf_interpreter)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		elf_entry = load_elf_interp(&amp;amp;loc-&amp;gt;interp_elf_ex,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					    interpreter,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					    &amp;amp;interp_map_addr,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					    load_bias);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		elf_entry = loc-&amp;gt;elf_ex.e_entry;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	start_thread(regs, elf_entry, bprm-&amp;gt;p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é™¤äº†å„ç§æ ¼å¼çš„å¤„ç†ä¹‹å¤–ï¼Œå¦‚æœå¯æ‰§è¡Œæ–‡ä»¶ç”¨åˆ°äº†å¤–éƒ¨çš„åŠ¨æ€å…±äº«åº“ï¼Œå†…æ ¸åˆ™ä¼šå°†è¿”å›ä½ç½®è®¾ç½®ä¸ºloaderçš„å…¥å£ï¼Œå°†æ§åˆ¶æƒè½¬äº¤ç»™loaderï¼Œç”±loaderè¿›è¡Œå…±äº«åº“çš„æŸ¥æ‰¾ã€åŠ è½½ï¼Œè°ƒè½¬åˆ°ç¨‹åºå…¥å£ï¼›å¦åˆ™å†…æ ¸å°†è¿”å›ä½ç½®è®¾ç½®ä¸ºç¨‹åºå…¥å£&lt;code&gt;loc-&amp;gt;elf_ex.e_entry&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;start_thread&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; pt_regs *regs, &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; new_ip, &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; new_sp)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	set_user_gs(regs, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	regs-&amp;gt;fs		= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	regs-&amp;gt;ds		= __USER_DS;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	regs-&amp;gt;es		= __USER_DS;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	regs-&amp;gt;ss		= __USER_DS;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	regs-&amp;gt;cs		= __USER_CS;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	regs-&amp;gt;ip		= new_ip;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	regs-&amp;gt;sp		= new_sp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	regs-&amp;gt;flags		= X86_EFLAGS_IF;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	set_thread_flag(TIF_NOTIFY_RESUME);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;start_thread&lt;/code&gt;è®¾ç½®å†…æ ¸æ ˆé¡¶çš„å¯„å­˜å™¨ï¼Œä½¿å¾—è¿›ç¨‹ä»ä¸­æ–­ä¸­è¿”å›åå¯åˆ°è¾¾åˆé€‚çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ä½¿ç”¨gdbè·Ÿè¸ªexecveç³»ç»Ÿè°ƒç”¨&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨gdbè·Ÿè¸ªexecveç³»ç»Ÿè°ƒç”¨&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨gdbè·Ÿè¸ªexecveç³»ç»Ÿè°ƒç”¨&quot;&gt;&lt;/a&gt;ä½¿ç”¨gdbè·Ÿè¸ªexecveç³»ç»Ÿè°ƒç”¨&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬åœ¨&lt;a href=&quot;https://github.com/mengning/menu/blob/master/test_exec.c&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;menu&lt;/a&gt;ä¸­åŠ å…¥&lt;code&gt;fork&lt;/code&gt;ä¸€ä¸ªå­è¿›ç¨‹å¹¶åŠ è½½&lt;code&gt;hello&lt;/code&gt;çš„å‘½ä»¤&lt;em&gt;exec&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨gdbåœ¨ä¸Šè¿°æåˆ°çš„å‡ ä¸ªå¤„ç†å‡½æ•°çš„å…¥å£è®¾ç½®æ–­ç‚¹ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/10/Linuxä¸­è£…è½½å’Œå¯åŠ¨å¯æ‰§è¡Œç¨‹åº/set_breaks.png&quot; alt=&quot;è®¾ç½®æ–­ç‚¹&quot; title=&quot;è®¾ç½®æ–­ç‚¹&quot;&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°å†…æ ¸åœ¨å¤„ç†å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½æ—¶çš„ç¡®åœåœ¨äº†è¿™äº›ä½ç½®ä¸Šï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/10/Linuxä¸­è£…è½½å’Œå¯åŠ¨å¯æ‰§è¡Œç¨‹åº/breaks.png&quot; alt=&quot;æ–­ç‚¹&quot; title=&quot;æ–­ç‚¹&quot;&gt;
&lt;h1 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h1&gt;&lt;p&gt;å½“æˆ‘ä»¬åœ¨Linuxä¸‹æ‰§è¡Œä¸€ä¸ªæ–°ç¨‹åºçš„æ—¶å€™ï¼Œä¸€èˆ¬æ¥è¯´éœ€è¦è¿›è¡Œè£…è½½å’Œé“¾æ¥ä¸¤ä¸ªåŠ¨ä½œã€‚å…¶ä¸­è£…è½½ç”±å†…æ ¸ä¸­æ–­å¤„ç†å‡½æ•°å®Œæˆï¼Œå¦‚éœ€è¦è¿›è¡ŒåŠ¨æ€åº“çš„é“¾æ¥ï¼Œå†…æ ¸åˆ™ä¼šå°†æ§åˆ¶æƒäº¤ç»™loaderè®©å…¶å®Œæˆå·¥ä½œã€‚ç¨‹åºå‘˜ä¹Ÿå¯ä»¥åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­è‡ªè¡Œè°ƒç”¨loaderè¿›è¡ŒåŠ¨æ€åº“çš„åŠ è½½å’Œç¬¦å·çš„è§£æã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„  &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 
    
    </summary>
    
    
      <category term="Linux" scheme="http://blog.sirany.me/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linuxå†…æ ¸åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹çš„è¿‡ç¨‹</title>
    <link href="http://blog.sirany.me/2016/04/03/Linux%E5%86%85%E6%A0%B8%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E8%BF%9B%E7%A8%8B%E7%9A%84%E8%BF%87%E7%A8%8B/"/>
    <id>http://blog.sirany.me/2016/04/03/Linuxå†…æ ¸åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹çš„è¿‡ç¨‹/</id>
    <published>2016-04-03T13:20:10.000Z</published>
    <updated>2016-04-11T04:36:27.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;å­˜å‚¨è¿›ç¨‹ä¿¡æ¯çš„task-struct&quot;&gt;&lt;a href=&quot;#å­˜å‚¨è¿›ç¨‹ä¿¡æ¯çš„task-struct&quot; class=&quot;headerlink&quot; title=&quot;å­˜å‚¨è¿›ç¨‹ä¿¡æ¯çš„task_struct&quot;&gt;&lt;/a&gt;å­˜å‚¨è¿›ç¨‹ä¿¡æ¯çš„task_struct&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/include/linux/sched.h#1235&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;sched.h&lt;/a&gt;ä¸­çš„&lt;code&gt;task_struct&lt;/code&gt;ç»“æ„ä½“å­˜å‚¨äº†å„ä¸ªè¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯ã€‚è¿™ä¸ªç»“æ„ä½“çš„å®šä¹‰ä¹Ÿæ¯”è¾ƒé•¿ï¼Œå¹¶ä¸”å«æœ‰è®¸å¤šæ ¹æ®æ¡ä»¶ç¼–è¯‘çš„æˆå‘˜ã€‚ä»¥ä¸‹æˆªå–ä¸€äº›é‡è¦çš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°å†…æ ¸ä¸­æ‰€ä½¿ç”¨çš„æ•°æ®ç»“æ„æ˜¯ä¸€äº›ä¾µå…¥å¼çš„åå­—é“¾è¡¨ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; state;	&lt;span class=&quot;comment&quot;&gt;/* è¿›ç¨‹çš„æ‰§è¡ŒçŠ¶æ€ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *&lt;span class=&quot;built_in&quot;&gt;stack&lt;/span&gt;;	&lt;span class=&quot;comment&quot;&gt;/* å†…æ ¸å †æ ˆ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; list_head tasks;	&lt;span class=&quot;comment&quot;&gt;/* æ‰€æœ‰è¿›ç¨‹ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; mm_struct *mm, *active_mm;	&lt;span class=&quot;comment&quot;&gt;/* å†…å­˜ç›¸å…³çš„ä¿¡æ¯ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;pid_t&lt;/span&gt; pid;	&lt;span class=&quot;comment&quot;&gt;/* è¿›ç¨‹çš„pid */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;pid_t&lt;/span&gt; tgid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct __rcu *real_parent;	&lt;span class=&quot;comment&quot;&gt;/* çˆ¶è¿›ç¨‹ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct __rcu *parent;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; list_head children;	&lt;span class=&quot;comment&quot;&gt;/* å­è¿›ç¨‹ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; list_head sibling;	&lt;span class=&quot;comment&quot;&gt;/* å…„å¼Ÿè¿›ç¨‹é“¾è¡¨ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct *group_leader;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; signal_struct *signal;	&lt;span class=&quot;comment&quot;&gt;/* ä¿¡å·ç›¸å…³ä¿¡æ¯ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; sighand_struct *sighand;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; thread_struct thread;	&lt;span class=&quot;comment&quot;&gt;/* CPUç›¸å…³çš„è¿›ç¨‹çŠ¶æ€ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; fs_struct *fs;	&lt;span class=&quot;comment&quot;&gt;/* æ–‡ä»¶ç³»ç»Ÿç›¸å…³ä¿¡æ¯ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; files_struct *files;	&lt;span class=&quot;comment&quot;&gt;/* æ–‡ä»¶ç›¸å…³ä¿¡æ¯ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;thread_struct&lt;/code&gt;å­˜å‚¨æ¯ä¸ªè¿›ç¨‹çš„CPUç›¸å…³çš„ä¸€äº›å…³é”®ä¿¡æ¯ï¼Œå¦‚&lt;em&gt;sp&lt;/em&gt;ã€&lt;em&gt;ip&lt;/em&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; thread_struct &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;		sp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;		ip;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å†…æ ¸å †æ ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¤§å°ä¸º8Kçš„unionï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;union&lt;/span&gt; thread_union &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; thread_info thread_info;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;stack&lt;/span&gt;[THREAD_SIZE/&lt;span class=&quot;keyword&quot;&gt;sizeof&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; thread_info &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct	*task;		&lt;span class=&quot;comment&quot;&gt;/* main task structure */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; exec_domain	*exec_domain;	&lt;span class=&quot;comment&quot;&gt;/* execution domain */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	__u32			flags;		&lt;span class=&quot;comment&quot;&gt;/* low level flags */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	__u32			status;		&lt;span class=&quot;comment&quot;&gt;/* thread synchronous flags */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	__u32			cpu;		&lt;span class=&quot;comment&quot;&gt;/* current CPU */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;			saved_preempt_count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;mm_segment_t&lt;/span&gt;		addr_limit;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; restart_block    restart_block;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; __user		*sysenter_return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;		sig_on_uaccess_error:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;		uaccess_err:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;	&lt;span class=&quot;comment&quot;&gt;/* uaccess failed */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;åˆ›å»ºæ–°è¿›ç¨‹æ—¶å¯¹task-structçš„å¤„ç†&quot;&gt;&lt;a href=&quot;#åˆ›å»ºæ–°è¿›ç¨‹æ—¶å¯¹task-structçš„å¤„ç†&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºæ–°è¿›ç¨‹æ—¶å¯¹task_structçš„å¤„ç†&quot;&gt;&lt;/a&gt;åˆ›å»ºæ–°è¿›ç¨‹æ—¶å¯¹task_structçš„å¤„ç†&lt;/h1&gt;&lt;p&gt;æ— è®ºæ˜¯&lt;code&gt;sys_fork&lt;/code&gt;ã€&lt;code&gt;sys_vfork&lt;/code&gt;ï¼Œè¿˜æ˜¯&lt;code&gt;sys_clone&lt;/code&gt;ï¼Œå®é™…ä¸Šéƒ½æ˜¯ä»¥ä¸åŒçš„å‚æ•°è°ƒç”¨äº†&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/kernel/fork.c#1623&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;fork.c&lt;/a&gt;ä¸­çš„&lt;code&gt;do_fork&lt;/code&gt;ï¼Œä¾‹å¦‚&lt;code&gt;sys_clone&lt;/code&gt;çš„å‡½æ•°ä½“ä¸ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; do_fork(clone_flags, newsp, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, parent_tidptr, child_tidptr);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œ&lt;code&gt;do_fork&lt;/code&gt;å¤„ç†forké€»è¾‘çš„ä¸»ä½“ï¼Œé™¤äº†ä¸€äº›å¯¹å‚æ•°çš„åˆ¤æ–­å¤„ç†å¤–ï¼Œå®ƒæ‰§è¡Œäº†ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct *p =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  copy_process(clone_flags, stack_start, stack_size, child_tidptr, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, trace);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å‚è€ƒLinux Man Pageä¸­å¯¹&lt;code&gt;pid_t fork(void)&lt;/code&gt;çš„æè¿°ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;fork() creates a new process by duplicating the calling process. The new process, referred to as the child, is an exact duplicate of the calling process, referred to as the parent, except for the following points:&lt;/p&gt;
&lt;p&gt;â€‹    The child has its own unique process IDâ€¦&lt;br&gt;â€‹    The child inherits copies of the parentâ€™s set of open file descriptorsâ€¦&lt;br&gt;â€‹    â€¦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çŸ¥é“å­è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„ä¸€ä¸ªæ‹·è´ï¼Œä½†ä¼šå¯¹æŸäº›ä¿¡æ¯è¿›è¡Œç‰¹åŒ–ã€‚è¿™å¯¹åº”äº&lt;code&gt;copy_process&lt;/code&gt;ä¸­åŒ…æ‹¬çš„ä¸€äº›åŠ¨ä½œï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct *p = dup_task_struct(current);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;copy_files(clone_flags, p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;copy_fs(clone_flags, p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;copy_sighand(clone_flags, p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;copy_signal(clone_flags, p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;copy_mm(clone_flags, p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;copy_namespaces(clone_flags, p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;copy_io(clone_flags, p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;copy_thread(clone_flags, stack_start, stack_size, p);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶ä¸­&lt;code&gt;dup_task_struct&lt;/code&gt;è¿›è¡Œäº†&lt;code&gt;task_struct&lt;/code&gt;ç»“æ„ä½“çš„çš„å¤åˆ¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct *tsk = alloc_task_struct_node(node);	&lt;span class=&quot;comment&quot;&gt;/* åˆ†é…æ–°çš„task_structç»“æ„ä½“ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; thread_info *ti = alloc_thread_info_node(tsk, node);	&lt;span class=&quot;comment&quot;&gt;/* åˆ†é…æ–°çš„å†…æ ¸æ ˆ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;arch_dup_task_struct(tsk, orig);	&lt;span class=&quot;comment&quot;&gt;/* *tsk = *origï¼Œæ‹·è´task_structç»“æ„ä½“ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tsk-&amp;gt;&lt;span class=&quot;built_in&quot;&gt;stack&lt;/span&gt; = ti;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;copy_files&lt;/code&gt;åˆ°&lt;code&gt;copy_io&lt;/code&gt;æ ¹æ®å‚æ•°å¯¹ä¸€äº›è¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯è¿›è¡Œå¤„ç†ï¼Œ&lt;code&gt;copy_thread&lt;/code&gt;å¤„ç†ï¼ˆæ‹·è´ï¼‰å†…æ ¸æ ˆä¸ŠCPUç›¸å…³çš„ä¿¡æ¯ï¼Œä»¥ä¾¿äºå­çº¿ç¨‹åç»­çš„æ¢å¤æ‰§è¡Œã€‚å…¶å¤§æ¦‚çš„æµç¨‹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; pt_regs *childregs = task_pt_regs(p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;p-&amp;gt;thread.sp = (&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;) childregs;	&lt;span class=&quot;comment&quot;&gt;/* å¤åˆ¶æ ˆé¡¶ä½ç½® */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;p-&amp;gt;thread.sp0 = (&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;) (childregs+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*childregs = *current_pt_regs();	&lt;span class=&quot;comment&quot;&gt;/* å¤åˆ¶å†…æ ¸æ ˆä¸Šä¿å­˜çš„å¯„å­˜å™¨ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                	&lt;span class=&quot;comment&quot;&gt;/* è¿™äº›æ­¥éª¤å¯ä»¥ä¿è¯å­è¿›ç¨‹å¯ä»¥æ¢å¤å‡ºå’Œçˆ¶è¿›ç¨‹ä¸€æ ·çš„ç°åœº */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;childregs-&amp;gt;ax = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;	&lt;span class=&quot;comment&quot;&gt;/* fork åœ¨å­è¿›ç¨‹ä¸­çš„è¿”å›å€¼æ˜¯0 */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (sp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	childregs-&amp;gt;sp = sp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* å­è¿›ç¨‹è¢«è°ƒåº¦åä»system_callä¸­çš„ret_from_forkå¼€å§‹æ‰§è¡Œ */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;p-&amp;gt;thread.ip = (&lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;) ret_from_fork;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* ... */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;copy_thread&lt;/code&gt;æ˜¯æ¶æ„ç›¸å…³çš„ï¼Œå®ƒåœ¨&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/arch/x86/kernel/process_32.c#132&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;process_32.c&lt;/a&gt;ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ret_from_fork&lt;/code&gt;åˆ™åœ¨&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/arch/x86/kernel/entry_32.S#290&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;entry_32.S&lt;/a&gt;ä¸­ï¼Œå®ƒè·³è½¬åˆ°&lt;code&gt;system_call&lt;/code&gt;ä¸­çš„&lt;code&gt;system_exit&lt;/code&gt;ç»§ç»­æ‰§è¡Œä»ç³»ç»Ÿè°ƒç”¨ä¸­è¿”å›çš„é€»è¾‘ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ENTRY(ret_from_fork)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	CFI_STARTPROC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pushl_cfi %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	call schedule_tail&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	GET_THREAD_INFO(%ebp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	popl_cfi %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pushl_cfi $0x0202		# Reset kernel eflags&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	popfl_cfi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	jmp syscall_exit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	CFI_ENDPROC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;END(ret_from_fork)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;è·Ÿè¸ªå†…æ ¸ä¸­forkçš„è¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#è·Ÿè¸ªå†…æ ¸ä¸­forkçš„è¿‡ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;è·Ÿè¸ªå†…æ ¸ä¸­forkçš„è¿‡ç¨‹&quot;&gt;&lt;/a&gt;è·Ÿè¸ªå†…æ ¸ä¸­forkçš„è¿‡ç¨‹&lt;/h1&gt;&lt;p&gt;åœ¨&lt;a href=&quot;https://github.com/mengning/menu/blob/master/test_fork.c&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;menu&lt;/a&gt;ä¸­åŠ å…¥Forkå‡½æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Fork&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *argv[])&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; pid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;/* fork another process */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pid = fork();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (pid&amp;lt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;/* error occurred */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;built_in&quot;&gt;fprintf&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;stderr&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;Fork Failed!&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (pid==&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;/*	 child process 	*/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	&lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;This is Child Process!\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123; 	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;/* 	parent process	 */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	&lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;This is Parent Process!\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;/* parent will wait for the child to complete*/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		wait(&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;Child Complete!\n&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨gdbä¸­è®¾ç½®ä¸€äº›æ–­ç‚¹ï¼Œå¹¶è®©å†…æ ¸åœåœ¨&lt;code&gt;sys_clone&lt;/code&gt;/&lt;code&gt;do_fork&lt;/code&gt;å¤„ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/03/Linuxå†…æ ¸åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹çš„è¿‡ç¨‹/do_fork.png&quot; alt=&quot;do_fork&quot; title=&quot;do_fork&quot;&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°&lt;code&gt;do_fork&lt;/code&gt;è¿›å…¥äº†&lt;code&gt;copy_process&lt;/code&gt;ã€‚è€Œ&lt;code&gt;copy_process&lt;/code&gt;å…ˆæ˜¯è¿›å…¥&lt;code&gt;dup_task_struct&lt;/code&gt;å¯¹&lt;code&gt;task_struct&lt;/code&gt;è¿›è¡Œæ‹·è´ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/03/Linuxå†…æ ¸åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹çš„è¿‡ç¨‹/dup_task_struct.png&quot; alt=&quot;dup_task_struct&quot; title=&quot;dup_task_struct&quot;&gt;
&lt;p&gt;ä¹‹åæ˜¯æ‹·è´å’Œç‰¹åŒ–å†…æ ¸æ ˆä¿¡æ¯çš„&lt;code&gt;copy_thread&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/03/Linuxå†…æ ¸åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹çš„è¿‡ç¨‹/copy_thread.png&quot; alt=&quot;copy_thread&quot; title=&quot;copy_thread&quot;&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨&lt;code&gt;ret_from_fork&lt;/code&gt;å¤„è®¾ç½®æ–­ç‚¹ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å­è¿›ç¨‹åœ¨è¿™é‡Œå¼€å§‹æ‰§è¡Œï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/04/03/Linuxå†…æ ¸åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹çš„è¿‡ç¨‹/ret_from_fork.png&quot; alt=&quot;ret_from_fork&quot; title=&quot;ret_from_fork&quot;&gt;
&lt;h1 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h1&gt;&lt;p&gt;å†…æ ¸åˆ›å»ºå­è¿›ç¨‹çš„è¿‡ç¨‹å¯ä»¥ç®€å•çš„æ€»ç»“ä¸ºå¯¹çˆ¶è¿›ç¨‹è¿›è¡Œæ‹·è´ï¼Œç„¶åè¿›è¡Œä¸€ç³»åˆ—å…³äºå­è¿›ç¨‹çš„ç‰¹åŒ–ï¼Œå¦‚å†…æ ¸æ ˆä¿¡æ¯ï¼Œè¿”å›ä½ç½®ç­‰ã€‚&lt;code&gt;task_struct&lt;/code&gt;ç»“æ„ä½“è¢«ç”¨äºå­˜å‚¨å†…æ ¸ä¸­å’Œæ¯ä¸ªè¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 i
    
    </summary>
    
    
      <category term="Linux" scheme="http://blog.sirany.me/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>system_callä¸­æ–­çš„å¤„ç†è¿‡ç¨‹</title>
    <link href="http://blog.sirany.me/2016/03/27/system-call%E4%B8%AD%E6%96%AD%E7%9A%84%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B/"/>
    <id>http://blog.sirany.me/2016/03/27/system-callä¸­æ–­çš„å¤„ç†è¿‡ç¨‹/</id>
    <published>2016-03-27T12:19:30.000Z</published>
    <updated>2016-04-04T03:04:15.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;ä½¿ç”¨gdbè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å†…æ ¸å‡½æ•°&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨gdbè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å†…æ ¸å‡½æ•°&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨gdbè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å†…æ ¸å‡½æ•°&quot;&gt;&lt;/a&gt;ä½¿ç”¨gdbè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å†…æ ¸å‡½æ•°&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬åœ¨&lt;a href=&quot;https://github.com/mengning/menu&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;menu&lt;/a&gt;çš„test.cä¸­åŠ å…¥ä¸€äº›è°ƒç”¨äº†ç³»ç»Ÿè°ƒç”¨çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Hello&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *argv[])&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; write(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;hello, world\n&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;) &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ? &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HelloAsm&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *argv[])&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *greeting = &lt;span class=&quot;string&quot;&gt;&quot;hello, world\n&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ret;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;asm&lt;/span&gt; (   &lt;span class=&quot;string&quot;&gt;&quot;mov $1, %%ebx\n\t&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;mov $14, %%edx\n\t&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;mov $4, %%eax\n\t&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;int $0x80\n\t&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;mov %%eax, %0&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            : &lt;span class=&quot;string&quot;&gt;&quot;=m&quot;&lt;/span&gt;(ret)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            : &lt;span class=&quot;string&quot;&gt;&quot;c&quot;&lt;/span&gt;(greeting));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ret &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ? &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PrintPid&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *argv[])&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;%u\n&quot;&lt;/span&gt;, getpid());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Time&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *argv[])&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;time_t&lt;/span&gt; tt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; tm *t;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    tt = time(&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    t = localtime(&amp;amp;tt);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;time:%d:%d:%d:%d:%d:%d\n&quot;&lt;/span&gt;,t-&amp;gt;tm_year+&lt;span class=&quot;number&quot;&gt;1900&lt;/span&gt;, t-&amp;gt;tm_mon, t-&amp;gt;tm_mday, t-&amp;gt;tm_hour, t-&amp;gt;tm_min, t-&amp;gt;tm_sec);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    PrintMenuOS();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SetPrompt(&lt;span class=&quot;string&quot;&gt;&quot;MenuOS&amp;gt;&amp;gt;&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MenuConfig(&lt;span class=&quot;string&quot;&gt;&quot;time&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Get the current time.&quot;&lt;/span&gt;, Time);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MenuConfig(&lt;span class=&quot;string&quot;&gt;&quot;print-pid&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Print Pid.&quot;&lt;/span&gt;, PrintPid);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MenuConfig(&lt;span class=&quot;string&quot;&gt;&quot;hello&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Say Hello.&quot;&lt;/span&gt;, Hello);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MenuConfig(&lt;span class=&quot;string&quot;&gt;&quot;hello-asm&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Say Hello (ASM).&quot;&lt;/span&gt;, HelloAsm);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MenuConfig(&lt;span class=&quot;string&quot;&gt;&quot;version&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;XXX V1.0(Menu program v1.0 inside)&quot;&lt;/span&gt;,&lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MenuConfig(&lt;span class=&quot;string&quot;&gt;&quot;quit&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;Quit from XXX&quot;&lt;/span&gt;,Quit);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ExecuteMenu();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¼–è¯‘menuåˆ°rootfsä¸­å¹¶å¯åŠ¨å†…æ ¸ï¼Œå¯ä»¥çœ‹åˆ°è¿™äº›æ–°åŠ å…¥çš„å‘½ä»¤å‡ºç°åœ¨å‘½ä»¤åˆ—è¡¨ä¸­ï¼š&lt;/p&gt;
 &lt;img src=&quot;/2016/03/27/system-callä¸­æ–­çš„å¤„ç†è¿‡ç¨‹/syscall.png&quot; alt=&quot;syscall&quot; title=&quot;syscall&quot;&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥åœ¨timeè°ƒç”¨å¯¹åº”çš„å†…æ ¸å¤„ç†å‡½æ•°sys_timeå¤„è®¾ç½®æ–­ç‚¹ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/03/27/system-callä¸­æ–­çš„å¤„ç†è¿‡ç¨‹/break.png&quot; alt=&quot;break&quot; title=&quot;break&quot;&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°sys_timeåœ¨å†…æ ¸æºç ä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Cå‡½æ•°ï¼Œè€Œæ˜¯ç”±å®æ‰€å®šä¹‰çš„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SYSCALL_DEFINE1(time, &lt;span class=&quot;keyword&quot;&gt;time_t&lt;/span&gt; __user *, tloc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;time_t&lt;/span&gt; i = get_seconds();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tloc) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (put_user(i,tloc))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; -EFAULT;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	force_successful_syscall_return();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; i;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨å¤„ç†å®Œç³»ç»Ÿè°ƒç”¨åè¿”å›å‰ï¼Œå†…æ ¸ä¼šè¿›å…¥è°ƒåº¦é€»è¾‘ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/03/27/system-callä¸­æ–­çš„å¤„ç†è¿‡ç¨‹/schedule.png&quot; alt=&quot;schedule&quot; title=&quot;schedule&quot;&gt;
&lt;p&gt;åœ¨è¿™ä¹‹åçš„æ±‡ç¼–ä»£ç æ— æ³•è¢«gdbè·Ÿè¸ªã€‚&lt;/p&gt;
&lt;p&gt;å€¼å¾—æ³¨æ„çš„æ˜¯ä¸€äº›å†…æ ¸ç¬¦å·å¯ä»¥è¢«gdbå¼•ç”¨ï¼Œä½†gdbæ— æ³•ä½¿å†…æ ¸åœ¨è¿™äº›ç¬¦å·å¤„åœä¸‹æ¥ï¼Œå¦‚sys_getpidã€system_callï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/03/27/system-callä¸­æ–­çš„å¤„ç†è¿‡ç¨‹/unstoppable.png&quot; alt=&quot;unstoppable&quot; title=&quot;unstoppable&quot;&gt;
&lt;h1 id=&quot;entry-32-Sä¸­system-callå¯¹åº”ä»£ç &quot;&gt;&lt;a href=&quot;#entry-32-Sä¸­system-callå¯¹åº”ä»£ç &quot; class=&quot;headerlink&quot; title=&quot;entry_32.Sä¸­system_callå¯¹åº”ä»£ç &quot;&gt;&lt;/a&gt;entry_32.Sä¸­system_callå¯¹åº”ä»£ç &lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/arch/x86/kernel/entry_32.S&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;arch/x86/kernel/entry_32.S&lt;/a&gt;ä¸­ä»&lt;code&gt;ENTRY(system_call)&lt;/code&gt;å¼€å§‹çš„ä¸€æ®µä»£ç è´Ÿè´£å¤„ç†system_callä¸­æ–­ï¼Œå½“&lt;code&gt;int 0x80&lt;/code&gt;æ‰§è¡Œæ—¶ç³»ç»Ÿä¾¿ä¼šè·³è½¬åˆ°æ­¤å¤„ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ENTRY(system_call)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	RING0_INT_FRAME			# can&#39;t unwind into user space anyway&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	ASM_CLAC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pushl_cfi %eax			# save orig_eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	SAVE_ALL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	GET_THREAD_INFO(%ebp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					# system call tracing in operation / emulation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	testl $_TIF_WORK_SYSCALL_ENTRY,TI_flags(%ebp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	jnz syscall_trace_entry&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	cmpl $(NR_syscalls), %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	jae syscall_badsys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;syscall_call:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	call *sys_call_table(,%eax,4)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;syscall_after_call:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl %eax,PT_EAX(%esp)		# store the return value&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;syscall_exit:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	LOCKDEP_SYS_EXIT&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	DISABLE_INTERRUPTS(CLBR_ANY)	# make sure we don&#39;t miss an interrupt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					# setting need_resched or sigpending&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					# between sampling and the iret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	TRACE_IRQS_OFF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl TI_flags(%ebp), %ecx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	testl $_TIF_ALLWORK_MASK, %ecx	# current-&amp;gt;work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	jne syscall_exit_work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;restore_all:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	TRACE_IRQS_IRET&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¦å®Œæ•´ç†è§£è¿™æ®µä»£ç éœ€è¦å……åˆ†çš„å†…æ ¸çŸ¥è¯†ï¼Œä½†æ˜¯ä»æ€»ä½“ä¸Šä»ç„¶å¯ä»¥çœ‹å‡ºå†…æ ¸å¤„ç†ç³»ç»Ÿè°ƒç”¨ä¸­æ–­çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;img src=&quot;/2016/03/27/system-callä¸­æ–­çš„å¤„ç†è¿‡ç¨‹/system_call_workflow.png&quot; alt=&quot;system_call_workflow&quot; title=&quot;system_call_workflow&quot;&gt;
&lt;ol&gt;
&lt;li&gt;ä¿å­˜æ‰€æœ‰çš„å¯„å­˜å™¨ï¼š&lt;code&gt;SAVE_ALL&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ ¹æ®&lt;code&gt;%eax&lt;/code&gt;ä¸­çš„ç³»ç»Ÿè°ƒç”¨å·è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼š&lt;code&gt;call *sys_call_table(,%eax,4)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç»“æŸå¤„ç†ä¹‹å‰çš„å·¥ä½œï¼š&lt;code&gt;jne syscall_exit_work&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ¢å¤å¯„å­˜å™¨ï¼š&lt;code&gt;RESTORE_REGS 4&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä»ä¸­æ–­ä¸­è¿”å›ï¼š&lt;code&gt;INTERRUPT_RETURN&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;system_exit_work&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;work_notifysig&lt;/code&gt;ï¼ˆå¤„ç†ä¿¡å·ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;schedule&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è·³è½¬å›ä¸Šè¿°çš„4ï¼ˆ&lt;em&gt;restore_all&lt;/em&gt;ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;schedule&lt;/code&gt;åœ¨&lt;a href=&quot;http://codelab.shiyanlou.com/xref/linux-3.18.6/kernel/sched/core.c&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;kernel/sched/core.c&lt;/a&gt;ä¸­ï¼Œè°ƒç”¨&lt;code&gt;__schedule&lt;/code&gt;è¿›è¡Œè°ƒåº¦ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;asmlinkage __visible &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; __&lt;span class=&quot;function&quot;&gt;sched &lt;span class=&quot;title&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; task_struct *tsk = current;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	sched_submit_work(tsk);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	__schedule();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 i
    
    </summary>
    
    
      <category term="Linux" scheme="http://blog.sirany.me/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ç³»ç»Ÿè°ƒç”¨çš„ä¸¤ç§ä½¿ç”¨æ–¹å¼</title>
    <link href="http://blog.sirany.me/2016/03/20/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%9A%84%E4%B8%A4%E7%A7%8D%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F/"/>
    <id>http://blog.sirany.me/2016/03/20/ç³»ç»Ÿè°ƒç”¨çš„ä¸¤ç§ä½¿ç”¨æ–¹å¼/</id>
    <published>2016-03-20T06:12:26.000Z</published>
    <updated>2016-04-15T11:48:08.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä»¥ä¸¤æ®µè°ƒç”¨Linuxç³»ç»Ÿè°ƒç”¨çš„ä»£ç ä¸ºä¾‹åˆ†æLinuxç³»ç»Ÿè°ƒç”¨çš„å·¥ä½œæ–¹å¼ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ç³»ç»Ÿè°ƒç”¨çš„ä»‹ç»&quot;&gt;&lt;a href=&quot;#ç³»ç»Ÿè°ƒç”¨çš„ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ç³»ç»Ÿè°ƒç”¨çš„ä»‹ç»&quot;&gt;&lt;/a&gt;ç³»ç»Ÿè°ƒç”¨çš„ä»‹ç»&lt;/h1&gt;&lt;p&gt;ç³»ç»Ÿè°ƒç”¨çš„å®é™…å®ç°æ–¹å¼ä¸ºç”±ç‰¹æ®ŠæŒ‡ä»¤ &lt;code&gt;int 0x80&lt;/code&gt; å‘èµ·ä¸€ä¸ªè½¯ä¸­æ–­ã€‚CPUæ•è·åˆ°ä¸­æ–­åï¼Œä¿å­˜ç¨‹åºçš„ä¸Šä¸‹æ–‡åˆ°æ ˆä¸Šï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å †æ ˆé¡¶åœ°å€ï¼›&lt;/li&gt;
&lt;li&gt;çŠ¶æ€å­—ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cs:eip&lt;/code&gt; çš„å€¼ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç„¶åæ ¹æ®ä¸­æ–­çš„ç±»å‹ä»ä¸­æ–­å‘é‡è¡¨ä¸­é€‰æ‹©å¯¹åº”çš„ä¸­æ–­æœåŠ¡ä¾‹ç¨‹ï¼ˆISRï¼‰çš„åœ°å€è½½å…¥&lt;code&gt;cs:eip&lt;/code&gt;ï¼ŒCPUè¿›å…¥å†…æ ¸æ€å¼€å§‹æ‰§è¡ŒISRã€‚åœ¨ç³»ç»Ÿè°ƒç”¨çš„æƒ…å†µä¸‹ï¼ˆ0x80ä¸­æ–­ï¼‰ï¼ŒISRä¼šæ ¹æ®ä¼ å…¥çš„çš„ç³»ç»Ÿè°ƒç”¨å·è°ƒç”¨å…·ä½“çš„å®ç°å‡½æ•°æ¥å“åº”ç³»ç»Ÿè°ƒç”¨ã€‚å½“ISRå®Œæˆå·¥ä½œåï¼Œä¼šä»æ ˆä¸Šæ¢å¤è¿™äº›ä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨x86æ¶æ„ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ä¼ é€’ä½¿ç”¨å¯„å­˜å™¨æ¥å®Œæˆï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Syscall #&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Param 1&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Param 2&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Param 3&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Param 4&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Param 5&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Param 6&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;eax&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;ebx&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;ecx&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;edx&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;esi&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;edi&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;ebp&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Return value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;eax&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å½“ç„¶ï¼Œå®é™…çš„ä½¿ç”¨ä¸­æ“ä½œç³»ç»Ÿé€šå¸¸å°†ç³»ç»Ÿè°ƒç”¨å°è£…æˆCå‡½æ•°ï¼Œç¨‹åºå‘˜åªéœ€è¦å¼•å…¥é€‚å½“çš„å¤´æ–‡ä»¶å¹¶è°ƒç”¨å¯¹åº”çš„å‡½æ•°å³å¯å®Œæˆç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨ã€‚è€Œè¿™äº›å°è£…åçš„C APIçš„å®ç°ä¸Šä¹Ÿä½¿ç”¨äº†&lt;code&gt;int $0x80&lt;/code&gt;æŒ‡ä»¤æ¥å®Œæˆå…·ä½“çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;h1 id=&quot;ä¾‹å­&quot;&gt;&lt;a href=&quot;#ä¾‹å­&quot; class=&quot;headerlink&quot; title=&quot;ä¾‹å­&quot;&gt;&lt;/a&gt;ä¾‹å­&lt;/h1&gt;&lt;p&gt;ä»¥ä¸‹æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼æ¥å®Œæˆå¯¹&lt;code&gt;write&lt;/code&gt;çš„ç³»ç»Ÿè°ƒç”¨ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *greeting = &lt;span class=&quot;string&quot;&gt;&quot;hello, world\n&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; write(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, greeting, &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;) &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ? &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯¹&lt;code&gt;int $0x80&lt;/code&gt;çš„ç›´æ¥è°ƒç”¨ä½¿ç”¨å†…åµŒæ±‡ç¼–æ¥å®Œæˆï¼š&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; *greeting = &lt;span class=&quot;string&quot;&gt;&quot;hello, world\n&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ret;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;asm&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&quot;mov $1, %%ebx\n\t&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;string&quot;&gt;&quot;mov $14, %%edx\n\t&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;string&quot;&gt;&quot;mov $4, %%eax\n\t&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;string&quot;&gt;&quot;int $0x80\n\t&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;string&quot;&gt;&quot;mov %%eax, %0&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         : &lt;span class=&quot;string&quot;&gt;&quot;=m&quot;&lt;/span&gt;(ret)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         : &lt;span class=&quot;string&quot;&gt;&quot;c&quot;&lt;/span&gt;(greeting));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ret &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ? &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡å¯¹ä¸¤æ®µç¨‹åºçš„ç¼–è¯‘æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä»¬å®Œæˆäº†ä¸€æ ·çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;img src=&quot;/2016/03/20/ç³»ç»Ÿè°ƒç”¨çš„ä¸¤ç§ä½¿ç”¨æ–¹å¼/sys_call.png&quot; alt=&quot;sys_call&quot; title=&quot;sys_call&quot;&gt;
&lt;h1 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h1&gt;&lt;p&gt;æ“ä½œç³»ç»Ÿå†…æ ¸å®é™…ä¸Šå¯ä»¥è§†ä¸ºç”±ä¸€ç»„ISRç»„æˆï¼ŒCPUæ•è·åˆ°ä¸­æ–­åé™·å…¥åˆ°å†…æ ¸æ€å¹¶è¿›å…¥ç›¸åº”çš„ISRæ¥å“åº”ä¸åŒçš„ç³»ç»Ÿäº‹ä»¶ã€‚ç³»ç»Ÿè°ƒç”¨å°è£…äº†å¯¹åº•å±‚ç¡¬ä»¶çš„æ“ä½œï¼Œç”±å†…æ ¸å®Œæˆã€‚å…¶ä½¿ç”¨ä¹Ÿæ˜¯é€šè¿‡ä¸­æ–­è¿™ä¸€æ–¹å¼ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‚è€ƒèµ„æ–™&quot;&gt;&lt;a href=&quot;#å‚è€ƒèµ„æ–™&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒèµ„æ–™&quot;&gt;&lt;/a&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.packagecloud.io/eng/2016/04/05/the-definitive-guide-to-linux-system-calls/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Definitive Guide to Linux System Calls&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡
    
    </summary>
    
    
      <category term="Linux" scheme="http://blog.sirany.me/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹</title>
    <link href="http://blog.sirany.me/2016/03/13/%E8%B7%9F%E8%B8%AALinux%E5%86%85%E6%A0%B8%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/"/>
    <id>http://blog.sirany.me/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/</id>
    <published>2016-03-13T02:51:04.000Z</published>
    <updated>2016-04-14T00:58:00.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ç»“åˆLinuxå†…æ ¸ä»£ç 3.18.6ä¸­çš„init/main.céƒ¨åˆ†ä»£ç ä½¿ç”¨gdbè·Ÿè¸ªäº†Linuxæ“ä½œç³»ç»Ÿçš„å¯åŠ¨è¿‡ç¨‹(éƒ¨åˆ†)ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨QEMUåŠ è½½å†…æ ¸é•œåƒï¼ŒåŒæ—¶æŒ‡å®šæ ¹æ–‡ä»¶ç³»ç»Ÿã€‚å¯åŠ¨åæ•ˆæœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/booting.png&quot; alt=&quot;booting&quot; title=&quot;booting&quot;&gt;
&lt;p&gt;åœ¨QEMUçš„å¯åŠ¨é€‰é¡¹ä¸­åŠ å…¥&lt;code&gt;-S -s&lt;/code&gt;ä½¿å…¶åœ¨å¯åŠ¨æ—¶å†»ç»“å¹¶å¼€æ”¾1234ç«¯å£ä¾›gdbè°ƒè¯•ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/start_qemu.png&quot; alt=&quot;start_qemu&quot; title=&quot;start_qemu&quot;&gt;
&lt;p&gt;è¿›å…¥gdbè¿æ¥ä¸Šå†…æ ¸å¹¶è®¾ç½®æ–­ç‚¹åœ¨start_kernelå¤„ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/setup_gdb.png&quot; alt=&quot;setup_gdb&quot; title=&quot;setup_gdb&quot;&gt;
&lt;p&gt;ä½¿ç”¨gdbå‘½ä»¤cæ¢å¤å†…æ ¸è¿è¡Œï¼Œå†…æ ¸åœæ­¢åœ¨start_kernelå¤„ï¼š&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/start_kernel.png&quot; alt=&quot;start_kernel&quot; title=&quot;start_kernel&quot;&gt;&lt;/p&gt;
&lt;p&gt;start_kernelå‡½æ•°å¯¹å†…æ ¸çš„å„ä¸ªæ¨¡å—è¿›è¡Œåˆå§‹åŒ–ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/src_init_modules1.png&quot; alt=&quot;src_init_modules1&quot; title=&quot;src_init_modules1&quot;&gt;
&lt;p&gt;åŒ…æ‹¬ç»ˆç«¯ã€å†…å­˜ã€cgroupã€consoleç­‰ã€‚&lt;/p&gt;
&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/init_modules.png&quot; alt=&quot;init_modules&quot; title=&quot;init_modules&quot;&gt;
&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/src_init_modules2.png&quot; alt=&quot;src_init_modules2&quot; title=&quot;src_init_modules2&quot;&gt;
&lt;p&gt;start_kernelæœ€åè°ƒç”¨çš„å‡½æ•°ä¸ºrest_initï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/rest_init.png&quot; alt=&quot;rest_init&quot; title=&quot;rest_init&quot;&gt;
&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/src_rest_init.png&quot; alt=&quot;src_rest_init&quot; title=&quot;src_rest_init&quot;&gt;
&lt;p&gt;rest_initä¸­å¯åŠ¨äº†æ ¹æ–‡ä»¶ç³»ç»Ÿä¸­çš„1å·ç”¨æˆ·æ€è¿›ç¨‹ï¼Œå¯åŠ¨çš„kthreadå†…æ ¸çº¿ç¨‹ï¼Œåœ¨æœ€åè¿›å…¥cpu_idleã€‚&lt;/p&gt;
&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/init_process.png&quot; alt=&quot;init_process&quot; title=&quot;init_process&quot;&gt;
&lt;p&gt;cpu_idle_loopä¸º0å·è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ°¸ä¹…å¾ªç¯ï¼Œå½“CPUä¸Šæ²¡æœ‰ç”¨æˆ·è¿›ç¨‹è¢«è°ƒåº¦æ—¶æ‰§è¡Œï¼š&lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/src_idle.png&quot; alt=&quot;src_idle&quot; title=&quot;src_idle&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¯åŠ¨å®Œæ¯•ï¼Œè¿›å…¥ç”¨æˆ·æ€ï¼š &lt;img src=&quot;/2016/03/13/è·Ÿè¸ªLinuxå†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹/done.png&quot; alt=&quot;done&quot; title=&quot;done&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡
    
    </summary>
    
    
      <category term="Linux" scheme="http://blog.sirany.me/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªç®€å•çš„æ—¶é—´ç‰‡è½®è½¬å¤šé“ç¨‹åºå†…æ ¸ä»£ç åˆ†æ</title>
    <link href="http://blog.sirany.me/2016/03/06/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%97%B6%E9%97%B4%E7%89%87%E8%BD%AE%E8%BD%AC%E5%A4%9A%E9%81%93%E7%A8%8B%E5%BA%8F%E5%86%85%E6%A0%B8%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://blog.sirany.me/2016/03/06/ä¸€ä¸ªç®€å•çš„æ—¶é—´ç‰‡è½®è½¬å¤šé“ç¨‹åºå†…æ ¸ä»£ç åˆ†æ/</id>
    <published>2016-03-06T02:47:43.000Z</published>
    <updated>2016-04-14T00:57:31.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†åˆ†æ&lt;a href=&quot;https://github.com/mengning/mykernel&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/mengning/mykernel&lt;/a&gt;ä¸­çš„ä¸€ä¸ªç®€å•è°ƒåº¦å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å†…æ ¸çš„å…¥å£ä¸ºmymain.cä¸­çš„&lt;code&gt;void __init my_start_kernel(void)&lt;/code&gt;ï¼Œ&lt;/p&gt;
&lt;img src=&quot;/2016/03/06/ä¸€ä¸ªç®€å•çš„æ—¶é—´ç‰‡è½®è½¬å¤šé“ç¨‹åºå†…æ ¸ä»£ç åˆ†æ/my_main.png&quot; alt=&quot;my_main&quot; title=&quot;my_main&quot;&gt;
&lt;p&gt;&lt;code&gt;my_start_kernel&lt;/code&gt;åˆå§‹åŒ–äº†taskæ•°ç»„ä¸­çš„4ä¸ªè¿›ç¨‹ï¼Œå³å››ä¸ªtPCBç»“æ„ä½“ã€‚å…¶ä¸­pidä¸ºè¿›ç¨‹å·ï¼ˆ0-3ï¼‰ï¼Œipå‡ä¸ºmy_processçš„åœ°å€ï¼Œstateå‡ä¸º-1ï¼ˆæœªè¿è¡Œï¼‰ï¼Œspä¸ºæ ˆé¡¶ä½ç½®ï¼ˆtPCBç»“æ„ä¸­ï¼‰ã€‚æ‰€æœ‰è¿›ç¨‹ä»¥ç¯å½¢é“¾è¡¨çš„æ–¹å¼ç»„ç»‡åœ¨ä¸€èµ·ä»¥ä¾¿åç»­è½®è½¬è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹åçš„ä¸€æ®µæ±‡ç¼–ä»£ç å°†0å·è¿›ç¨‹çš„æ ˆé¡¶èµ‹ç»™espï¼Œå¹¶è°ƒè½¬åˆ°å…¶ipçš„ä½ç½®ã€‚&lt;/p&gt;
&lt;img src=&quot;/2016/03/06/ä¸€ä¸ªç®€å•çš„æ—¶é—´ç‰‡è½®è½¬å¤šé“ç¨‹åºå†…æ ¸ä»£ç åˆ†æ/my_process.png&quot; alt=&quot;my_process&quot; title=&quot;my_process&quot;&gt;
&lt;p&gt;æ‰€æœ‰è¿›ç¨‹æ‰§è¡Œçš„ä»£ç å‡ä¸º&lt;code&gt;void my_process(void)&lt;/code&gt;ï¼Œå…¶å†…å®¹ä¸ºæ¯æ‰§è¡Œä¸€æ®µæ—¶é—´æ£€æŸ¥&lt;code&gt;my_need_sched&lt;/code&gt;æ˜¯å¦è¢«ç½®1ï¼Œè‹¥æ˜¯åˆ™æ‰§è¡Œ&lt;code&gt;my_schedule()&lt;/code&gt;ä¸»åŠ¨è®©å‡ºæ‰§è¡Œã€‚&lt;/p&gt;
&lt;img src=&quot;/2016/03/06/ä¸€ä¸ªç®€å•çš„æ—¶é—´ç‰‡è½®è½¬å¤šé“ç¨‹åºå†…æ ¸ä»£ç åˆ†æ/my_timer_handler.png&quot; alt=&quot;my_timer_handler&quot; title=&quot;my_timer_handler&quot;&gt;
&lt;p&gt;&lt;code&gt;my_timer_hanlder&lt;/code&gt;å“åº”äº†ç³»ç»Ÿä¸­çš„å®šæ—¶å™¨ä¸­æ–­ï¼Œå½“å®šæ—¶å™¨ä¸­æ–­ä¸€å®šæ¬¡æ•°åå°†&lt;code&gt;my_need_sched&lt;/code&gt;ç½®1ï¼Œä»¥è®©å½“å‰è¿›ç¨‹ä¸»åŠ¨è®©å‡ºã€‚&lt;/p&gt;
&lt;p&gt;è°ƒåº¦å™¨çš„ä»£ç åœ¨&lt;code&gt;void my_schedule(void)&lt;/code&gt;å‡½æ•°ä¸­ï¼Œæ ¹æ®ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼ˆnextï¼‰çš„çŠ¶æ€ï¼ˆæœªè¿è¡Œæˆ–è€…è¿è¡Œä¸­ï¼‰æ‰§è¡Œä¸åŒçš„è°ƒåº¦å‡†å¤‡å·¥ä½œã€‚&lt;/p&gt;
&lt;img src=&quot;/2016/03/06/ä¸€ä¸ªç®€å•çš„æ—¶é—´ç‰‡è½®è½¬å¤šé“ç¨‹åºå†…æ ¸ä»£ç åˆ†æ/my_schedule_1.png&quot; alt=&quot;my_schedule_1&quot; title=&quot;my_schedule_1&quot;&gt;
&lt;p&gt;è‹¥ä¸‹ä¸€è¿›ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼šä¿å­˜å½“å‰çš„ebpåˆ°æ ˆä¸Šï¼Œä¿å­˜å½“å‰çš„espåˆ°è¿›ç¨‹ç»“æ„ä½“ä¸­ï¼Œä»ç›®æ ‡è¿›ç¨‹çš„ç»“æ„ä½“ä¸­å›å¤espï¼Œå°†ä¸‹é¢è·³è½¬æŒ‡ä»¤åé¢çš„åœ°å€ä½œä¸ºè¿”å›åœ°å€ä¿å­˜åˆ°è¿›ç¨‹ç»“æ„ä½“ä¸­ï¼Œè·³è½¬åˆ°ç›®æ ‡è¿›ç¨‹ã€‚å½“ä»ç›®æ ‡è¿›ç¨‹è¿”å›æ—¶ï¼Œä»æ ˆä¸Šæ¢å¤ebpã€‚&lt;/p&gt;
&lt;img src=&quot;/2016/03/06/ä¸€ä¸ªç®€å•çš„æ—¶é—´ç‰‡è½®è½¬å¤šé“ç¨‹åºå†…æ ¸ä»£ç åˆ†æ/my_schedule_2.png&quot; alt=&quot;my_schedule_2&quot; title=&quot;my_schedule_2&quot;&gt;
&lt;p&gt;è‹¥ä¸‹ä¸€è¿›ç¨‹æœªè¿è¡Œï¼šå”¯ä¸€çš„åŒºåˆ«æ˜¯å°†ç›®æ ‡è¿›ç¨‹çš„æ ˆé¡¶åœ°å€ä¹Ÿèµ‹ç»™ebpï¼ˆå› ä¸ºæ­¤æ—¶ç›®æ ‡è¿›ç¨‹æ ˆä¸ºç©ºï¼Œä¸”ä¸ä¼šæ¢å¤ebpï¼‰ï¼Œå…¶ä»–éƒ¨åˆ†å’Œä¸Šé¢çš„æƒ…å†µç›¸åŒã€‚&lt;/p&gt;
&lt;p&gt;è¿™å‡ ä¸ªå‡½æ•°é…åˆåˆ™å®Œæˆäº†ä¸€ä¸ªç®€å•çš„æ—¶é—´ç‰‡è½®è½¬çš„å¤šé“ç¨‹åºå†…æ ¸ã€‚ä»¥ä¸‹æ˜¯å†…æ ¸æ‰§è¡Œæ—¶çš„è¿›ç¨‹åˆ‡æ¢ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/03/06/ä¸€ä¸ªç®€å•çš„æ—¶é—´ç‰‡è½®è½¬å¤šé“ç¨‹åºå†…æ ¸ä»£ç åˆ†æ/qemu.png&quot; alt=&quot;qemu&quot; title=&quot;qemu&quot;&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡
    
    </summary>
    
    
      <category term="Linux" scheme="http://blog.sirany.me/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªç®€å•Cç¨‹åºçš„åæ±‡ç¼–</title>
    <link href="http://blog.sirany.me/2016/02/28/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95C%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%8F%8D%E6%B1%87%E7%BC%96/"/>
    <id>http://blog.sirany.me/2016/02/28/ä¸€ä¸ªç®€å•Cç¨‹åºçš„åæ±‡ç¼–/</id>
    <published>2016-02-28T02:36:06.000Z</published>
    <updated>2016-04-14T00:57:47.000Z</updated>
    
    <content type="html">&lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç°ä»£è®¡ç®—æœºçš„è¿è¡Œæ–¹å¼å¯ä»¥è¢«æŠ½è±¡ä¸ºå†¯è¯ºä¾æ›¼ä½“ç³»ç»“æ„ï¼Œå³å­˜å‚¨ç¨‹åºè®¡ç®—æœºã€‚ç¨‹åºä¸æ•°æ®ä¸€èµ·è¢«å­˜å‚¨åœ¨å†…å­˜ï¼ˆå¤–å­˜ï¼‰ä¸­ï¼ŒCPUæŒ‰é¡ºåºè¯»å–ç¨‹åºæŒ‡ä»¤å¹¶æ‰§è¡Œã€‚ä¸‹é¢ä»¥ä¸€ä¸ªç®€å•çš„Cç¨‹åºä¸ºä¾‹å­ä»‹ç»ç°ä»£è®¡ç®—æœºçš„å·¥ä½œæ–¹å¼ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; x)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; x + &lt;span class=&quot;number&quot;&gt;123&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; x)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; g(x);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; f(&lt;span class=&quot;number&quot;&gt;456&lt;/span&gt;) + &lt;span class=&quot;number&quot;&gt;789&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å¯¹å…¶è¿›è¡Œæ±‡ç¼–ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;gcc -S main.c -m32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¾—åˆ°æ±‡ç¼–ä»£ç ï¼ˆåˆ å‡åï¼‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;g:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pushl	%ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	%esp, %ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	8(%ebp), %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	addl	$123, %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	popl	%ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	ret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;f:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pushl	%ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	%esp, %ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	subl	$4, %esp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	8(%ebp), %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	%eax, (%esp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	call	g&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	leave&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	ret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;main:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pushl	%ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	%esp, %ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	subl	$4, %esp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	$456, (%esp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	call	f&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	addl	$789, %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	leave&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	ret&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ•´ä¸ªç¨‹åºç”±gã€fã€mainä¸‰ä¸ªå‡½æ•°ç»„æˆï¼Œåœ¨å…·ä½“è¿è¡Œæ—¶å‡½æ•°å°†ä»¥main -&amp;gt; f -&amp;gt; gçš„æ¬¡åºä¾æ¬¡è¢«è°ƒç”¨ã€‚ç°ä»£è®¡ç®—æœºä½¿ç”¨æ ˆæ¥å¤„ç†å‡½æ•°é—´çš„è°ƒç”¨ã€‚å½“å‘ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ï¼Œè°ƒç”¨è€…å°†å‚æ•°å’Œè¿”å›åœ°å€æ”¾åˆ°æ ˆä¸Šï¼Œç„¶åè·³è½¬åˆ°è¢«è°ƒç”¨è€…ï¼Œè¢«è°ƒç”¨è€…å»ºç«‹æ–°çš„æ ˆå¸§ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ¥çœ‹mainã€‚æ¯æ¬¡è¿›å…¥å‡½æ•°æ—¶ï¼Œè¿›è¡Œæ ˆå¸§å‡†å¤‡å·¥ä½œï¼šå°†%ebpå…¥æ ˆï¼Œå¹¶å°†%espçš„å€¼ä½œä¸ºæ–°çš„%ebpï¼ˆ0x2000ï¼‰ã€‚ç„¶åå‡†å¤‡è¢«è°ƒç”¨å‡½æ•°fçš„å‚æ•°ï¼šå°†456å…¥æ ˆã€‚è°ƒç”¨fï¼Œå°†è¿”å›åœ°å€ï¼ˆcallæŒ‡ä»¤çš„ä¸‹ä¸€æ¡ï¼‰å…¥æ ˆã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;main:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pushl	%ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	%esp, %ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	subl	$4, %esp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	$456, (%esp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	call	f&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	addl	$789, %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	leave&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	ret&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Addr&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Content&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;0x2000&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;saved %ebp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;0x1996&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;456&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;0x1992&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;address of &lt;code&gt;addl $789, %eax&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç¨‹åºè·³è½¬åˆ°fã€‚åŒæ ·çš„å‡†å¤‡æ ˆå¸§ï¼Œæ ˆå¸§å‡†å¤‡å¥½åå‚æ•°ä»&lt;code&gt;8(%ebp)&lt;/code&gt;å¼€å§‹ã€‚få–å‡ºå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆ456ï¼‰ä½œä¸ºgçš„å‚æ•°å¹¶å…¥æ ˆã€‚è°ƒç”¨gã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;f:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pushl	%ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	%esp, %ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	subl	$4, %esp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	8(%ebp), %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	%eax, (%esp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	call	g&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	leave&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	ret&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Addr&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Content&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;0x1988&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;saved %ebp = 0x2000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;0x1984&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;456&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;0x1980&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;address of &lt;code&gt;leave&lt;/code&gt; in f&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿›å…¥å‡½æ•°gã€‚å‡†å¤‡æ ˆå¸§ï¼Œå–å‡ºå‚æ•°ï¼ˆ456ï¼‰åˆ°%eaxä¸­ï¼Œå¯¹å…¶åŠ 123ã€‚è¿”å›ä¸Šä¸€çº§å‡½æ•°ï¼Œå‡½æ•°è¿”å›æ—¶å¯¹æ ˆå¸§è¿›è¡Œæ‹†é™¤ï¼ˆleaveï¼‰ï¼Œå°†%ebpçš„å€¼èµ‹ç»™%espï¼Œå¹¶å°†æ ˆé¡¶ä¸Šæ—§çš„%ebpæ¢å¤åˆ°%ebpä¸­ã€‚è¿™é‡Œç”±äºæ ˆä¸Šä»…æœ‰saved &lt;code&gt;%ebp&lt;/code&gt;ï¼Œåªéœ€æ‰§è¡Œ&lt;code&gt;popl %ebp&lt;/code&gt;ã€‚æ‰§è¡Œretè¿”å›ä¸Šä¸€çº§å‡½æ•°fã€‚è¿”å›å€¼åœ¨%eaxä¸­ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;g:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pushl	%ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	%esp, %ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	movl	8(%ebp), %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	addl	$123, %eax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	popl	%ebp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	ret&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Addr&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Content&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;0x1976&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;saved %ebp = 0x1988&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;éšåfæ‰§è¡Œleaveæ‹†é™¤æ ˆå¸§ï¼Œå¹¶è¿”å›mainã€‚mainä¹Ÿæ‰§è¡Œleaveæ‹†é™¤æ ˆå¸§ï¼Œå¹¶è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;ç°ä»£è®¡ç®—æœºï¼ˆx86ç­‰æ¶æ„ï¼‰å‡ä¸ºå­˜å‚¨ç¨‹åºè®¡ç®—æœºã€‚ç¨‹åºå’Œæ•°æ®ä¸€èµ·è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚CPUé€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counterï¼‰æ§åˆ¶ç¨‹åºçš„é¡ºåºæ‰§è¡Œæˆ–è·³è½¬ã€‚åŒä¸€ABIä¸‹çš„ç¨‹åºæŒ‰ç…§ä¸€å®šçš„æ ‡å‡†ä½¿ç”¨æŒ‡ä»¤ã€å¯„å­˜å™¨ã€æ ˆç­‰ç¡¬ä»¶èµ„æºï¼Œå¦‚x86-64ä¸‹çš„Linuxéµå¾ªSystem V ABIã€‚éµå¾ªåŒä¸€å¥—ABIçš„äºŒè¿›åˆ¶ä»£ç å¯ä»¥äº’ç›¸å¼•ç”¨ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ¨æ–¯ç„¶ åŸåˆ›ä½œå“è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ &lt;a href=&quot;http://mooc.study.163.com/course/USTC-1000029000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ã€ŠLinuxå†…æ ¸åˆ†æã€‹MOOCè¯¾ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç°ä»£
    
    </summary>
    
    
      <category term="Linux" scheme="http://blog.sirany.me/tags/Linux/"/>
    
  </entry>
  
</feed>
